From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: ruViolence <78062896+ruViolence@users.noreply.github.com>
Date: Fri, 27 Jan 2023 09:52:18 +0500
Subject: [PATCH] fix: arrow velocity exploit


diff --git a/src/main/java/net/minecraft/server/EntityLiving.java b/src/main/java/net/minecraft/server/EntityLiving.java
index a4395ab3cde44bda444695b8a8351f87b34b9817..4444ecbb9b76abb92cfab7aa7644c17b27a0f4db 100644
--- a/src/main/java/net/minecraft/server/EntityLiving.java
+++ b/src/main/java/net/minecraft/server/EntityLiving.java
@@ -1746,12 +1746,25 @@ public abstract class EntityLiving extends Entity {
         return 0.42F;
     }
 
+    protected long lastJumpTime = 0L; // Reaper start - arrow velocity fix
     protected void cu() {
+        // Reaper start - arrow velocity fix
+        long time = System.nanoTime();
+        boolean canCrit = true;
+        if (this instanceof EntityPlayer) {
+            canCrit = false;
+            if (time - this.lastJumpTime > (long)(0.250e9)) {
+                this.lastJumpTime = time;
+                canCrit = true;
+            }
+        }
+        // Reaper end - arrow velocity fix
         this.motY = (double) this.ct();
         if (this.hasEffect(MobEffects.JUMP)) {
             this.motY += (double) ((float) (this.getEffect(MobEffects.JUMP).getAmplifier() + 1) * 0.1F);
         }
 
+        if (canCrit) // Reaper - arrow velocity fix
         if (this.isSprinting()) {
             float f = this.yaw * 0.017453292F;
 
